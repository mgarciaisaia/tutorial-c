
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Between a rock and a hard link - C para Operativos</title>
  <meta name="author" content="mgarciaisaia">

  
  <meta name="description" content="¿Qué es un hard link? ¿Qué es un soft link? ¿Qué diferencia hay entre ellos? Me parece que la clave para entender los enlaces en los filesystems &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mgarciaisaia.github.io/tutorial-c/blog/2015/02/07/between-a-rock-and-a-hard-link">
  <link href="/tutorial-c/favicon.png" rel="icon">
  <link href="/tutorial-c/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/tutorial-c/atom.xml" rel="alternate" title="C para Operativos" type="application/atom+xml">
  <script src="/tutorial-c/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/tutorial-c/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<link rel="stylesheet" href="/tutorial-c/stylesheets/gh-fork-ribbon.css" />
<!--[if IE]>
<link rel="stylesheet" href="/tutorial-c/stylesheets/gh-fork-ribbon.ie.css" />
<![endif]-->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-59960325-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/tutorial-c/">C para Operativos</a></h1>
  
    <h2>Aprendiendo C para una cursada feliz de Sistemas Operativos</h2>
  
  </hgroup>

<div class="github-fork-ribbon-wrapper right">
	<div class="github-fork-ribbon">
		<a href="https://github.com/mgarciaisaia/octopress">¡Forkeame!</a>
	</div>
</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/tutorial-c/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mgarciaisaia.github.io/tutorial-c" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/tutorial-c/">Blog</a></li>
  <li><a href="/tutorial-c/blog/archives">Archives</a></li>
  <li><a href="/tutorial-c/lo-c-tutto/">Lo C Tutto</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Between a Rock and a Hard Link</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-02-07T11:47:00-03:00" pubdate data-updated="true">Feb 7<span>th</span>, 2015</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><blockquote><p>¿Qué es un hard link? ¿Qué es un soft link? ¿Qué diferencia hay entre ellos?</p></blockquote>


<p>Me parece que la clave para entender los enlaces en los filesystems basados en inodos<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> es entender <em>qué es un archivo</em>.<!--more--></p>

<h2>Archivos y directorios</h2>

<p>Un archivo está compuesto por dos partes: su contenido (<em>los bloques de datos</em>) y su metadata (<em>el inodo</em>).</p>

<p>Cuando creo un archivo llamado <code>miarchivo.txt</code> cuyo único contenido es <code>hola</code> (con, por ejemplo, el comando <code>echo hola &gt; miarchivo.txt</code>), en mi FS se reserva un bloque de datos en el que se escriben los 5 bytes <code>hola\n</code><sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>, y además se reserva un inodo que se marca como ocupado, en el que se especifica que el contenido del archivo mide 5 bytes, y se establece en el primer puntero del inodo que el primer bloque de datos es el que acabamos de reservar. Se ponen más datos, obviamente, pero por ahora no nos importan.</p>

<p>Y con eso tenemos un archivo, pero nos falta algo importante: referenciarlo. Ese archivo <strong>no tiene nombre</strong>. <em>El inodo no guarda el nombre del archivo</em>. Y yo nunca le pido al sistema operativo que me abra el archivo del inodo 5236: yo le pido rutas. Y una ruta está formada por una lista de directorios, y el nombre del archivo al final.</p>

<p>El nombre existe en el directorio.</p>

<p>Un directorio es un archivo cuyo contenido es una tabla. Cada entrada de esa tabla (las <em>entradas de directorios</em>) relaciona un nombre de archivo con un número de inodo. Al querer abrir un archivo (digamos, <code>miarchivo.txt</code>), el FS busca en esa tabla la entrada con ese nombre, y mira cuál es el número de inodo que le corresponde (digamos, <code>402</code>), y hace todas las operaciones usando ese inodo. Siguiendo el ejemplo, si quisieramos leer todo el archivo <code>miarchivo.txt</code> (<code>cat miarchivo.txt</code>), el FS encuentra la entrada de directorio de ese archivo, lee que le corresponde el inodo 402, abre el inodo 402, mira que mide 5 bytes, busca cuál es el primer bloque de datos, lee los primeros 5 bytes de ese bloque de datos y se los devuelve a <code>cat</code>, que se encarga de imprimirlos por pantalla.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat miarchivo.txt
</span><span class='line'>hola
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Hard links</h2>

<p>Ahora, ¿qué me impide tener otra entrada de directorio que apunte al inodo 402? En el inodo no hay ninguna referencia del estilo <code>directorioPadre</code> ni nada por el estilo. Tranquilamente podría crear una nueva entrada en ese directorio (o en otro, es indistinto<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>) que apunte al mismo inodo. Asumamos que creamos una entrada para el nombre <code>passwords.txt</code>, que también apunta al inodo 402.</p>

<p>¿Qué va a ocurrir cuando quiera leer el archivo <code>passwords.txt</code> haciendo <code>cat passwords.txt</code>? Esto:</p>

<blockquote><p>el FS encuentra la entrada de directorio de ese archivo, lee que le corresponde el inodo 402, abre el inodo 402, mira que mide 5 bytes, busca cuál es el primer bloque de datos, lee los primeros 5 bytes de ese bloque de datos y se los devuelve a `cat`, que se encarga de imprimirlos por pantalla.</p></blockquote>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat passwords.txt
</span><span class='line'>hola
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Exactamente lo mismo que hace un rato, porque, a partir de que encontró que el inodo es el 402, el resto va todo igual: el inodo es lo que representa a nuestro archivo en el FS.</p>

<p>Y si quisiera agregarle contenido a <code>miarchivo.txt</code>, ¿qué pasaría? Ejecuto <code>echo clave123 &gt;&gt; miarchivo.txt</code>, y entonces el FS busca la entrada correspondiente a <code>miarchivo.txt</code>, encuentra que corresponde al inodo 402, va al inodo 402, ve que mide 5 bytes y que si le agrega los 9 bytes correspondientes a <code>clave123\n</code> sigue entrando en el primer bloque de datos, entonces abre el primer bloque de datos, y a partir del sexto byte escribe ese contenido. Por último, anota en el inodo que el archivo ahora pesa 14 bytes, cierra el archivo, y todos felices. Si ahora hacemos <code>cat miarchivo.txt</code>, encuentra la entrada de directorio<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>, abre el inodo 402, abre el bloque de datos, lee los 14 bytes, se los devuelve a <code>cat</code>, y <code>cat</code> los imprime por pantalla.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat miarchivo.txt
</span><span class='line'>hola
</span><span class='line'>clave123
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>¿Y si ahora leo el contenido de <code>passwords.txt</code>? Bueno, <em>leo la entrada de directorio de <code>passwords.txt</code>, veo que es el inodo 402, abro el inodo, veo que mide 14 bytes, abro el primer bloque de datos, leo los 14 bytes, y se los devuelvo a <code>cat</code> para que los imprima en pantalla</em>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat passwords.txt
</span><span class='line'>hola
</span><span class='line'>clave123
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Las dos entradas de directorio referencian al mismo archivo</strong>. Lo que <em>escribo en un archivo se ve reflejado en el otro</em>, pero porque <strong>es mentira que sean dos archivos</strong>: <em>son el mismo</em>. Son <em>dos referencias al mismo objeto</em>.</p>

<p>Ahora bien, podemos mirar por la consola que esos dos archivos referencian al mismo inodo. La clave está en el switch <code>-i</code> del comando <code>ls</code>, que acá vamos a usar junto con el <code>-1</code> para ver un archivo por línea:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -i1
</span><span class='line'>402 miarchivo.txt
</span><span class='line'>402 passwords.txt
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ambas entradas referencian al inodo 402.</p>

<p><strong>Ese es el concepto de hard link</strong>: varias entradas de directorio referenciando al mismo inodo. <em>Varias referencias al mismo archivo</em>.</p>

<p>Pero es interesante que, a partir del momento en que se crea el hard link, ya no existe <em>el archivo</em> y <em>el hard link</em>: el archivo es el inodo, y todas las referencias a inodos son hardlinks. O sea, técnicamente hablando, <em>todas las entradas de directorios son hard links</em>, pero coloquialmente hablando nos referimos a hard links en el momento en que hay más de una entrada refiriendo a ese inodo. Pero es importante tener siempre presente que, a partir de que se crea el hard link (es decir, que se crea la segunda entrada apuntando al mismo inodo), ya no hay diferencia entre la referencia original y la nueva: podríamos borrar <code>miarchivo.txt</code>, y <code>passwords.txt</code> seguiría existiendo y apuntando al mismo contenido. Podríamos crear un tercer hard link, borrar los dos anteriores, y el inodo seguiría siendo el mismo, con el mismo contenido.</p>

<p>Y, ya que estamos, ¿qué pasa si borro un hard link? ¿Cómo se cuándo liberar el inodo y los bloques de datos? Para eliminar un archivo, siempre uso el mismo comando: <code>rm</code>. Y no tengo que especificarle yo si es el último hard link o no, o si liberar o no el inodo: es el FS el que decide eso.</p>

<p>Para eso, el FS usa una técnica llamada <a href="http://en.wikipedia.org/wiki/Reference_counting">reference counting</a><sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup> (conteo de referencias). El inodo tiene un campo en el que se cuenta la cantidad de referencias que hay hacia él en el file system. Al crear un archivo, ese contador arranca en 1 (porque hay una única entrada de directorio que lo apunta), cuando se crea un hard link se aumenta en 1, y cuando se elimina una entrada (<em>se elimina un hard link</em>) se decrementa en 1. Si ese contador llega a 0, el FS libera el inodo y los bloques de datos asociados. De este modo, en el caso de <code>miarchivo.txt</code>, el inodo 402 arrancó con el contador de links en 1, y cuando creamos el hard link <code>passwords.txt</code> pasó a 2. Si ahora borramos alguno de los dos (es indistinto cuál, digamos que hacemos <code>rm miarchivo.txt</code>), se borra la entrada de directorio correspondiente y se decrementa en uno el contador de links del inodo 402, pasando a 1. Si borramos el link que quedaba (<code>rm passwords.txt</code>), el contador de links del inodo 402 pasa a 0, y ahí el FS libera ese inodo y el bloque de datos asociado.</p>

<p>Podemos ver la cantidad de hard links usando <code>ls -l</code> (o combinarlo con <code>-i</code> para ver también el número de inodo):</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -li
</span><span class='line'>total 2
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 miarchivo.txt
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 passwords.txt
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esos <code>2</code> que vemos entre los permisos y el owner del archivo es el contador de hard links. Creemos un archivo cualquiera para ver que tiene un único link:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>touch vacio
</span><span class='line'><span class="nv">$ </span>ls -li
</span><span class='line'>total 3
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 miarchivo.txt
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 passwords.txt
</span><span class='line'>406 -rw-r--r--+ 1 mgarcia staff 14 Feb 7 13:27 vacio
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Borremos tanto a <code>vacio</code> como a <code>miarchivo.txt</code> para ver que no les mentí<sup id="fnref:6"><a href="#fn:6" rel="footnote">6</a></sup>:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rm miarchivo.txt vacio
</span><span class='line'><span class="nv">$ </span>ls -li
</span><span class='line'>total 1
</span><span class='line'>402 -rw-r--r--+ 1 mgarcia staff 14 Feb 7 11:53 passwords.txt
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si borrara <code>passwords.txt</code>, recién ahí se liberaría el inodo 402.</p>

<p>Por último, un detalle de los hard links: toda la relación que existe entre la entrada de directorio y el inodo es el número de inodo. Debido a esto, los hard links sólo pueden realizarse <em>intra-filesystem</em>, es decir, el archivo destino y el directorio que contiene al nuevo link <strong>deben</strong> estar dentro del mismo file system<sup id="fnref:7"><a href="#fn:7" rel="footnote">7</a></sup>. Porque si no, ¿al inodo 402 de qué file system se refiere la entrada? ¿Qué garantías tengo de que el otro filesystem también maneje inodos? Por ese motivo, los hard links son intra-FS.</p>

<p>Y, algo que nos faltaba: ¿con qué creamos el hard link? Con el comando <code>ln</code>:</p>

<figure class='code'><figcaption><span>Esto es lo que ejecuté (hace un rato) para crear passwords.txt </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -li
</span><span class='line'>total 1
</span><span class='line'>402 -rw-r--r--+ 1 mgarcia staff 14 Feb 7 11:53 miarchivo.txt
</span><span class='line'><span class="nv">$ </span>ln miarchivo.txt passwords.txt
</span><span class='line'><span class="nv">$ </span>ls -li
</span><span class='line'>total 2
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 miarchivo.txt
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 passwords.txt
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Soft links</h2>

<p>Ahora bien, ¿ya está? Si quiero hacer un enlace a otro FS, ¿<a href="https://youtu.be/Pj1Hgw75V1w">estoy en el horno</a>? Nops: para eso hicieron los soft links :)</p>

<p>Un softlink<sup id="fnref:8"><a href="#fn:8" rel="footnote">8</a></sup> es un <strong>archivo nuevo</strong> que referencia a otra ruta. Creemos uno:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -li
</span><span class='line'>total 2
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 miarchivo.txt
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 passwords.txt
</span><span class='line'><span class="nv">$ </span>ln -s miarchivo.txt blandito
</span><span class='line'><span class="nv">$ </span>ls -li
</span><span class='line'>total 3
</span><span class='line'>415 lrwxr-xr-x  1 mgarcia staff 14 Feb 7 13:46 blandito -&gt; miarchivo.txt
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 miarchivo.txt
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 passwords.txt
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Por lo pronto, para crear un soft link le pasamos el parámetro <code>-s</code> a <code>ln</code>. Por otro lado, vemos que se creó una nueva entrada de directorio llamada <code>blandito</code><sup id="fnref:9"><a href="#fn:9" rel="footnote">9</a></sup>, <strong>que tiene su propio inodo</strong>. Es decir, es un archivo completamente separado de los otros. De hecho, tiene sus propios atributos: la <code>l</code> que vemos al principio es la que indica que ese archivo es un softlink. También vemos que el contador de links está en 1, porque, claro, este inodo (el 415) está referenciado únicamente por la entrada de directorio <code>blandito</code>.</p>

<p>Y, si es un inodo aparte, ¿cómo referencia al otro archivo? Bueno, el FS sabe que los archivos con el atributo de enlace (la <code>l</code> esa que vimos en los permisos) son softlinks, y entonces sabe que tiene que tratarlos de manera especial: cuando le pidan leerlo (<code>cat blandito</code>), no va a hacer lo que hacía siempre (abrir el inodo referenciado &ndash; 415 &ndash;, leer su contenido y pasárselo a <code>cat</code>). Por ser un softlink, el contenido que está guardado en el bloque de datos no es el contenido del archivo, si no <strong>la ruta del archivo al que enlaza</strong><sup id="fnref:10"><a href="#fn:10" rel="footnote">10</a></sup>. Entonces, al hacer <code>cat blandito</code> el FS abre el inodo 415, ve que es un softlink, lee el bloque de datos, ve que está guardada la ruta <code>miarchivo.txt</code>, y entonces, ahora sí, busca la entrada <code>miarchivo.txt</code>, abre el inodo correspondiente (el viejo y conocido 402), lee el bloque de datos, etc.</p>

<p>¿Se ve la diferencia? <strong>El contenido del softlink dice cuál es el path del archivo al que uno realmente quiere acceder.</strong> Esto es lo que le permite ser cross-FS: el link se puede hacer a, no se, <code>/mount/DVD/autorun.inf</code>, que sea otro FS, y no hay ningún problema: el identificador ya no es el número de inodo, y por eso puede ir a otros FS.</p>

<p>Del <code>ls</code> que hicimos después de crear el softlink tenemos que notar otro detalle: el link count del inodo 402 sigue en 2, <strong>no aumentó a 3</strong>. Esto significa que <strong>el archivo <em>apuntado</em> no se entera de que hay un softlink que lo enlaza</strong>.</p>

<p>El hecho de que el enlace esté hecho a nivel <em>ruta</em> (y no <em>inodo</em>) implica que puedo tener lo que se conoce como <em>enlaces rotos</em>: links que apuntan a archivos que no  existen [más]. Por ejemplo, ¿qué pasa si eliminamos <code>miarchivo.txt</code>? <code>blandito</code> sigue referenciando a un archivo llamado <code>miarchivo.txt</code>, pero ese archivo ya no existe, así que cualquier operación sobre el link va a fallar. No importa que siga existiendo <code>passwords.txt</code>, que sigue apuntando al inodo 402: el link funciona a nivel de paths. Lo mismo ocurre si renombro el archivo <code>miarchivo.txt</code>, o si pongo un archivo distinto llamado <code>miarchivo.txt</code>: el enlace apunta a <em>lo que sea que haya</em> en la ruta <code>miarchivo.txt</code>.</p>

<p>Existe un comando (más <em>low level</em><sup id="fnref:11"><a href="#fn:11" rel="footnote">11</a></sup> que <code>ls -l</code>) para leer el <em>destino</em> de un softlink: <code>readlink</code>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>readlink blandito
</span><span class='line'>miarchivo.txt
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Rompamos el enlace:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mv miarchivo.txt archivo.txt
</span><span class='line'><span class="nv">$ </span>ls -li
</span><span class='line'>total 3
</span><span class='line'>415 lrwxr-xr-x  1 mgarcia staff 14 Feb 7 13:46 blandito -&gt; miarchivo.txt
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 archivo.txt
</span><span class='line'>402 -rw-r--r--+ 2 mgarcia staff 14 Feb 7 11:53 passwords.txt
</span><span class='line'><span class="nv">$ </span>cat blandito
</span><span class='line'>cat: blandito: No such file or directory
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it :)</p>

<h2>Windows</h2>

<p>Ok, hablemos (un poco, medio de mala gana, y bastante desde el desconocimiento) de Windows.</p>

<p>En FAT no existen la conceptos de soft ni hard links. NTFS los tiene.</p>

<p>Lo que sí existe en Windows desde antes de NTFS son los viejos y conocidos accesos directos.</p>

<p>¿Qué son los accesos directos?</p>

<p>Bueno, son archivos que están guardados en el file system, y que cuando los abro en realidad me abren otros archivos a los que &ldquo;apuntan&rdquo;.</p>

<p><em>¡ESO ES UN SOFTLINK! ¡AHHHHH IGNORANTE! ¡ME MENTISTE! ¡¡¿¿VISTE QUE SÍ EXISTÍAN??!! Te dije que este pibe era un talibán linuxero y que no puede contar objetivamente nada de Windows.</em></p>

<p>Sí, bueno, no&hellip; Son softlinks, pero leé de nuevo lo que puse: FAT no soporta symlinks; Windows lo soporta.</p>

<p>¿Y qué cambia? Bueno, cambia bastante. En Windows/FAT, los accesos directos los interpreta el shell (es decir, la interfaz de ventanitas que te deja hacer doble click sobre los archivos), y no el file system. Esto significa que, dependiendo de cómo interactúe cada aplicación con la API de Windows, al abrir un acceso directo podría leer el contenido del archivo destino o el del propio acceso directo. Tengo la sensación de que en las versiones nuevas<sup id="fnref:12"><a href="#fn:12" rel="footnote">12</a></sup> de Windows hicieron algunos cambios para que esto no pase, pero, por ejemplo, uno puede darle doble click a un acceso directo a un txt en Windows XP para abrir el archivo destino en notepad<sup id="fnref:13"><a href="#fn:13" rel="footnote">13</a></sup>, pero si abrimos notepad y hacemos drag&amp;drop del acceso directo vamos a ver un montón de chirimbolos horrendos que tienen codificada de algún modo extraño la ruta al destino<sup id="fnref:14"><a href="#fn:14" rel="footnote">14</a></sup>.</p>

<p><img src="/tutorial-c/assets/shortcut-windows-xp.gif" alt="Abriendo accesos directos con notepado en Windows XP" /></p>

<p>En Unix/ext, el propio sistema de archivos se encarga de resolver el enlace al abrir un softlink, por lo que siempre vemos el contenido del destino<sup id="fnref:15"><a href="#fn:15" rel="footnote">15</a></sup>.</p>

<h2>Links útiles</h2>

<ul>
<li><a href="http://teaching.idallen.com/dat2330/04f/notes/links_and_inodes.html">http://teaching.idallen.com/dat2330/04f/notes/links_and_inodes.html</a></li>
</ul>

<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Existen los enlaces <del>en FAT</del> en Windows, pero funcionan a otro nivel, me disgustan, me caen mal <del>, y voy a ignorarlos rotundamente</del> :)<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>Por defecto, <code>echo</code> imprime un salto de línea, y por eso el <code>\n</code> al final del contenido. Se puede evitar el <code>\n</code> final haciendo <code>echo -n</code>.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>Sólo importa que sea dentro del mismo filesystem, ya veremos por qué.<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>A esta altura ya te habrás imaginado que tiene bastante sentido aplicar algúna técnica de caché para las entradas de directorios, porque <em>se usan bastante seguido</em>, je :)<a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
<li id="fn:5">
<p>Como dice el artículo de Wikipedia, la misma idea de reference counting se usa mucho en los garbage collectors de muchos lenguajes de programación de objetos.<a href="#fnref:5" rev="footnote">&#8617;</a></p></li>
<li id="fn:6">
<p>Que no les mentí <em>tanto</em>. Estoy inventando un poco esos outputs de los comandos, porque no los estoy corriendo realmente en la consola. Hago pruebas y lo fabrico, pero debería ser consistente.<a href="#fnref:6" rev="footnote">&#8617;</a></p></li>
<li id="fn:7">
<p>Sí, en el sistema operativo se pueden (y de hecho, se suelen) montar más de un sistema de archivos. Cuando metés un CD en la máquina, estás montando otro FS. Cuando tenés más de una partición disponible, estás montando más de un sistema de archivos. Incluso cuando tenés una partición de swap, estás montando otro sistema de archivos.<a href="#fnref:7" rev="footnote">&#8617;</a></p></li>
<li id="fn:8">
<p>&ldquo;softlink&rdquo;, &ldquo;soft link&rdquo;, &ldquo;enlace dinámico&rdquo;, &ldquo;enlace <em>suave</em>&rdquo;, <em>you name it</em><a href="#fnref:8" rev="footnote">&#8617;</a></p></li>
<li id="fn:9">
<p>Lo de <code>-&gt; miarchivo.txt</code> es información que agrega <code>ls</code> para ser <em>más usable</em>, pero esa información <strong>no está guardada en la entrada de directorio</strong>.<a href="#fnref:9" rev="footnote">&#8617;</a></p></li>
<li id="fn:10">
<p>La enorme mayoría de las implementaciones de ext optimizan el uso de disco almacenando la ruta destino <em>en el inodo</em> en lugar de en un bloque de datos aparte (escribiéndola en la zona reservada para los punteros a bloques de datos). De hecho, <a href="http://www.nongnu.org/ext2-doc/ext2.html#DEF-SYMBOLIC-LINKS">la especificación de ext2 dice que ese es el modo de hacerlo</a> (digamos, no lo nombra como un opcional). De todos modos, esto es una optimización de espacio, y no hace diferencias importantes a la hora de entender el concepto del symlink.<a href="#fnref:10" rev="footnote">&#8617;</a></p></li>
<li id="fn:11">
<p>En general, trato de usar los comandos de UNIX más <em>cercanos</em> a las llamadas al sistema. <code>ls</code> hace <em>muchas</em> cosas, no existe una llamada al sistema <code>ls</code>, pero sí existe una llamada al sistema <a href="http://linux.die.net/man/2/readlink">readlink</a> (o quizá no se llame así, pero cumple esa tarea específica).<a href="#fnref:11" rev="footnote">&#8617;</a></p></li>
<li id="fn:12">
<p>Llamar &ldquo;nuevas&rdquo; a las que tienen menos de 15 años de antigüedad denota mi pasión por <a href="http://i.imgur.com/91sn32Q.jpg?fb">gritarle a las nubes</a><a href="#fnref:12" rev="footnote">&#8617;</a></p></li>
<li id="fn:13">
<p>Hice recién la misma prueba en Windows 8.1, y funcionó del mismo modo, pero no se por qué siento que alguna vez me pasó distinto.<a href="#fnref:13" rev="footnote">&#8617;</a></p></li>
<li id="fn:14">
<p>Y, obviamente, si usamos el programa <code>edit</code> desde la consola/CMD/DOS, peor todavía.<a href="#fnref:14" rev="footnote">&#8617;</a></p></li>
<li id="fn:15">
<p>Entiendo que uno podría modificar una implementación de ext para que muestre el contenido de los enlaces en lugar de resolverlos, recompilarla, instalarla y montar un FS con esa implementación, pero sería <em>llevar las cosas bastante al límite</em>, y, obviamente, dejaría de ser ext (porque ya no cumple con la especificación de cómo abrir los enlaces, je).<a href="#fnref:15" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">mgarciaisaia</span></span>

      








  


<time datetime="2015-02-07T11:47:00-03:00" pubdate data-updated="true">Feb 7<span>th</span>, 2015</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="/tutorial-c//twitter.com/share" class="twitter-share-button" data-url="http://mgarciaisaia.github.io/tutorial-c/blog/2015/02/07/between-a-rock-and-a-hard-link/" data-via="" data-counturl="http://mgarciaisaia.github.io/tutorial-c/blog/2015/02/07/between-a-rock-and-a-hard-link/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="small"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/tutorial-c/blog/2014/12/26/int-vs-int32-t/" title="Previous Post: int vs int32_t">&laquo; int vs int32_t</a>
      
      
        <a class="basic-alignment right" href="/tutorial-c/blog/2015/02/19/aprendiendo-assembler-para-entender-c/" title="Next Post: Aprendiendo Assembler para entender C">Aprendiendo Assembler para entender C &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Acerca de...</h1>
  <p>Pequeña introducción a C y otras herramientas necesarias para desarrollar el TP de Sistemas Operativos de la UTN FRBA</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/tutorial-c/blog/2015/02/27/dream-of-serialization/">Dream of Serialization</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2015/02/24/aprendiendo-c-con-gdb/">Aprendiendo C Con GDB</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2015/02/19/aprendiendo-assembler-para-entender-c/">Aprendiendo Assembler Para Entender C</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2015/02/07/between-a-rock-and-a-hard-link/">Between a Rock and a Hard Link</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2014/12/26/int-vs-int32-t/">Int vs Int32_t</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2014/12/26/compiladores-y-errores/">Compiladores Y Errores</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2014/12/26/un-tutorial-rapido-para-implementar-y-debuggear-malloc/">Un Tutorial Rápido Para Implementar Y Debuggear Malloc, Free, Calloc Y Realloc</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2014/09/04/p-sherman-calle-wallaby-42-sydney/">P. Sherman, Calle Wallaby 42, Sydney</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2014/03/20/she-bangs-she-bangs/">She Bangs, She Bangs...</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2013/12/31/me-di-cuenta-que-me-tiraste-la-senal/">Me Dí Cuenta Que Me Tiraste La Señal</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2013/12/30/inotify/">Inotify</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2013/10/21/bajando-el-nivel/">Bajando El Nivel</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2013/08/20/variables/">Variables</a>
      </li>
    
      <li class="post">
        <a href="/tutorial-c/blog/2013/08/19/arrancando/">Arrancando</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sisoputnfrba">@sisoputnfrba</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sisoputnfrba',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/tutorial-c/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - mgarciaisaia -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tutorialc';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://mgarciaisaia.github.io/tutorial-c/blog/2015/02/07/between-a-rock-and-a-hard-link/';
        var disqus_url = 'http://mgarciaisaia.github.io/tutorial-c/blog/2015/02/07/between-a-rock-and-a-hard-link/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
